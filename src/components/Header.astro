---
import { SITE_TITLE } from '../consts';
import HeaderLink from './HeaderLink.astro';
import SearchModal from './SearchModal.astro';
const subpath = import.meta.env.BASE_URL;

---

<header class="fixed top-4 z-30 w-full px-4 md:px-10">
	<div class="mx-auto max-w-6xl rounded-xl border border-[color:var(--color-border)] bg-[color:var(--color-surface)] px-4 py-3 md:px-6 md:py-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
		<div class="flex items-center justify-between gap-4">
			<div class="flex flex-col">
				<h1 class="text-base font-semibold tracking-[0.18em] uppercase m-0">
					<a href={subpath} class="hover:opacity-80 transition-opacity">{SITE_TITLE}</a>
				</h1>
			</div>
		</div>
		<div class="flex flex-col gap-2 md:gap-3 md:flex-row md:items-center md:justify-end">
			<nav class="flex flex-wrap items-center gap-2 md:gap-4 text-[0.72rem] tracking-[0.24em] uppercase text-muted">
				<HeaderLink href="/blog">Blog</HeaderLink>
				<HeaderLink href="/team">Team</HeaderLink>
				<HeaderLink href="/about">About</HeaderLink>
				<SearchModal />
				<button class="theme-toggle" type="button" id="theme-toggle" aria-label="Toggle theme">
					<span class="sr-only">Toggle theme</span>
					<span class="theme-toggle__icon theme-toggle__icon--sun" aria-hidden="true">
						<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
							<circle cx="12" cy="12" r="4" />
							<path d="M12 3v2m0 14v2m9-9h-2M5 12H3m14.95 6.95-1.414-1.414M7.464 7.464 6.05 6.05m0 11.9 1.414-1.414M18.364 5.636l-1.414 1.414" />
						</svg>
					</span>
					<span class="theme-toggle__icon theme-toggle__icon--moon" aria-hidden="true">
						<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
							<path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79Z" />
						</svg>
					</span>
				</button>
			</nav>
		</div>
	</div>
</header>

<script is:inline>
const STORAGE_KEY = 'theme';

const getPreferredTheme = () => {
	const stored = localStorage.getItem(STORAGE_KEY);
	if (stored === 'light' || stored === 'dark') return stored;
	return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
};

const applyTheme = (theme) => {
	document.documentElement.dataset.theme = theme;
	const button = document.getElementById('theme-toggle');
	if (button) button.setAttribute('aria-pressed', theme === 'dark' ? 'true' : 'false');
};

const initTheme = () => {
	const theme = getPreferredTheme();
	applyTheme(theme);
};

const toggleTheme = () => {
	const current = document.documentElement.dataset.theme === 'dark' ? 'dark' : 'light';
	const next = current === 'dark' ? 'light' : 'dark';
	localStorage.setItem(STORAGE_KEY, next);
	applyTheme(next);
};

initTheme();

const toggleButton = document.getElementById('theme-toggle');
if (toggleButton) {
	toggleButton.addEventListener('click', toggleTheme);
}
</script>

<style is:inline>
.theme-toggle {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	width: 36px;
	height: 36px;
	border: 1px solid var(--color-border, rgba(0, 0, 0, 0.12));
	border-radius: 9999px;
	background: color-mix(in oklab, var(--color-surface, #fff) 92%, transparent 8%);
	color: var(--color-ink, currentColor);
	transition: border-color 150ms ease, background-color 150ms ease, color 150ms ease;
}
.theme-toggle:hover {
	border-color: color-mix(in oklab, var(--color-ink, #111) 32%, transparent);
	background: color-mix(in oklab, var(--color-surface, #fff) 85%, var(--color-ink, #111) 5%);
}
.theme-toggle__icon--moon {
	display: none;
}
html[data-theme='dark'] .theme-toggle__icon--sun {
	display: none;
}
html[data-theme='dark'] .theme-toggle__icon--moon {
	display: inline-flex;
}
</style>
