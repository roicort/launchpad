---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import FormattedDate from './FormattedDate.astro';

interface Props {
	title: string;
	href?: string;
	description?: string;
	date?: Date | string;
		image?: ImageMetadata | string;
	imageAlt?: string;
	eyebrow?: string;
}

const { title, href, description, date, image, imageAlt = '', eyebrow } = Astro.props as Props;

const baseDate = typeof date === 'string' ? new Date(date) : date;
const articleClass =
	'group flex h-full flex-col gap-4 rounded-[20px] border border-[color:var(--color-border)] bg-[color:var(--color-surface)]/95 p-5 shadow-none transition duration-200 hover:-translate-y-1 hover:shadow-[0_22px_55px_color-mix(in_oklab,var(--color-ink)_10%,transparent)]';
---

{href ? (
	<article class={articleClass}>
		<a
			href={href}
			class="flex flex-col gap-4 h-full text-current no-underline focus-visible:outline-2 focus-visible:outline-offset-4 focus-visible:outline-border"
		>
			{image && (
				<figure class="relative overflow-hidden rounded-2xl border border-border bg-[color-mix(in_oklab,var(--color-ink)_4%,var(--color-surface))]">
					{typeof image === 'string' ? (
						<img
							src={image}
							alt={imageAlt}
							loading="lazy"
							class="aspect-16/10 w-full object-cover transition duration-400 group-hover:scale-[1.02] sm:aspect-4/3"
						/>
					) : (
						<Image
							src={image}
							alt={imageAlt}
							loading="lazy"
							class="aspect-16/10 w-full object-cover transition duration-400 group-hover:scale-[1.02] sm:aspect-4/3"
						/>
					)}
				</figure>
			)}

			{eyebrow && <p class="text-[0.65rem] font-semibold uppercase tracking-[0.35em] text-subtle">{eyebrow}</p>}

			{baseDate && (
				<p class="text-sm text-muted">
					<FormattedDate date={baseDate} />
				</p>
			)}

			<h3 class="text-lg font-semibold leading-tight text-ink transition-colors duration-150 group-hover:text-ink sm:text-xl">
				<span>{title}</span>
			</h3>

			{description && <p class="text-[0.97rem] leading-relaxed text-muted">{description}</p>}
		</a>

		<div class="mt-auto pt-2 text-[0.95rem] text-ink/80">
			<slot />
		</div>
	</article>
) : (
	<article class={articleClass}>
		{image && (
			<figure class="relative overflow-hidden rounded-2xl border border-border bg-[color-mix(in_oklab,var(--color-ink)_4%,var(--color-surface))]">
				{typeof image === 'string' ? (
					<img
						src={image}
						alt={imageAlt}
						loading="lazy"
						class="aspect-16/10 w-full object-cover transition duration-400 group-hover:scale-[1.02] sm:aspect-4/3"
					/>
				) : (
					<Image
						src={image}
						alt={imageAlt}
						loading="lazy"
						class="aspect-16/10 w-full object-cover transition duration-400 group-hover:scale-[1.02] sm:aspect-4/3"
					/>
				)}
			</figure>
		)}

		{eyebrow && <p class="text-[0.65rem] font-semibold uppercase tracking-[0.35em] text-subtle">{eyebrow}</p>}

		{baseDate && (
			<p class="text-sm text-muted">
				<FormattedDate date={baseDate} />
			</p>
		)}

		<h3 class="text-lg font-semibold leading-tight text-ink transition-colors duration-150 group-hover:text-ink sm:text-xl">
			<span>{title}</span>
		</h3>

		{description && <p class="text-[0.97rem] leading-relaxed text-muted">{description}</p>}

		<div class="mt-auto pt-2 text-[0.95rem] text-ink/80">
			<slot />
		</div>
	</article>
)}
